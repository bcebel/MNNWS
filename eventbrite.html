<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ATX Short Film Showcase Events</title>
<!-- FullCalendar CSS -->
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css" rel="stylesheet">
<style>
body {
font-family: Arial, sans-serif;
max-width: 1000px;
margin: 20px auto;
padding: 0 10px;
}
#calendar {
margin-top: 20px;
}
.attribution {
font-size: 0.8em;
color: #555;
margin-top: 10px;
}
.fc-event-title {
cursor: pointer;
}
.error {
color: red;
text-align: center;
}
</style>
</head>
<body>
<h1>ATX Short Film Showcase Events</h1>
<div id="calendar"></div>
<p class="attribution">Events sourced from <a href="https://www.eventbrite.com" target="_blank">Eventbrite</a>.</p>

<!-- FullCalendar JS -->
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js"></script>
<script>
// Initialize FullCalendar
document.addEventListener('DOMContentLoaded', function() {
  const calendarEl = document.getElementById('calendar');

  const calendar = new FullCalendar.Calendar(calendarEl, {
    initialView: 'dayGridMonth', // Monthly view
    events: async (info, successCallback, failureCallback) => {
      try {
        // Eventbrite API call for a specific organization
        // The organization ID was provided by the user.
        const organizationId = '34019997591';
        const response = await fetch(
          `https://www.eventbriteapi.com/v3/organizations/${organizationId}/events/`,
          {
            headers: {
              // WARNING: For production environments, it is strongly recommended to use a server-side proxy
              // to handle API requests. Exposing API keys, even public ones, on the client-side can be a security risk.
              Authorization: 'Bearer 7HL7WDXN2HA66ZZL54E2', // Public API Key
            },
          }
        );

        if (!response.ok) {
            const errorBody = await response.text();
            console.error('API Error Body:', errorBody);
            throw new Error(`API request failed with status ${response.status}`);
        }

        const data = await response.json();

        // The response for this endpoint has an 'events' key which is a list of event objects.
        const events = data.events.map(event => ({
          title: event.name.text,
          start: event.start.local,
          url: event.url,
          extendedProps: {
            description: event.description.text?.substring(0, 100) + '...' || 'No description',
            source: 'Eventbrite',
          }
        }));

        successCallback(events);
      } catch (error) {
        console.error('Error fetching events:', error);
        document.getElementById('calendar').innerHTML = '<p class="error">Failed to load events. Please check the organization ID and your network connection.</p>';
        failureCallback(error);
      }
    },
    eventClick: function(info) {
      // Open event URL in new tab
      info.jsEvent.preventDefault();
      if (info.event.url) {
        window.open(info.event.url, '_blank');
      }
    },
    eventContent: function(info) {
      // Customize event display with attribution
      return {
        html: `
          <div>
            <b>${info.event.title}</b><br>
            <small>${info.event.extendedProps.description}</small><br>
            <small>Source: ${info.event.extendedProps.source}</small>
          </div>
        `
      };
    }
  });

  calendar.render();
});
</script>
</body>
</html>
